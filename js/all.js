!function(){var o=angular.module("MyBlog",["ngRoute","MyBlog.homeModule","MyBlog.musicModule","MyBlog.personModule","MyBlog.boardModule","MyBlog.logModule","doubanApp.httpModule","doubanApp.DetailModule","MyBlog.learnModule","MyBlog.movieModule"]);o.config(["$routeProvider",function(o){o.otherwise({redirectTo:"/home"})}]),o.constant("appConstant",{ListUrl:"https://api.douban.com/v2/movie/",detailUrl:"https://api.douban.com/v2/movie/subject/",songUrl:"http://api.jirengu.com/fm/getSong.php",lrcUrl:"http://api.jirengu.com/fm/getLyric.php",channelUrl:"http://api.jirengu.com/fm/getChannels.php",count:5}),o.directive("page",[function(){return{replace:!0,template:' <ul class="pagination ">                          <li ng-click="huddlePage(item)" ng-class="{active:current == item}" ng-repeat="item in pages" ><a >{{item}}</a></li>                       </ul>',link:function(o,e,r){o.$watch("pageConfig",function(e){if(e){var r=e.total,t=e.show,n=e.current,l=Math.floor(t/2),a=n-l;a=Math.max(a,1);var c=a+t-1;c>r&&(c=r,a=r-t+1,a=Math.max(a,1));var i=[];o.pages=i,o.current=n,o.huddlePage=function(o){e.click(o)};for(var u=a;u<=c;u++)i.push(u)}})}}}]),o.directive("search",["$location","$route","$routeParams","$timeout","$rootScope",function(o,e,r,t,n){return{replace:!0,template:'<form class="navbar-form movie-form" ng-submit="search()">                            <div class="input-group">                                <span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>                                <input type="text" class="form-control" placeholder="Search..." ng-model="input">                            </div>                         </form>',link:function(l,a,c){l.search=function(){var a=l.input;n.input=a,(a.length="undefined"==typeof a)||(r.list?e.updateParams({list:"search",q:a}):(o.path("search"),t(function(){e.updateParams({list:"search",q:a})},0)))}}}}]);var e=angular.module("doubanApp.httpModule",[]);e.service("JsonpService",["$window",function(o){this.jsonp=function(e,r,t){var n="?";for(key in r)n+=key+"="+r[key]+"&&";var l="Myjsonp_"+(new Date).getTime();n+="callback="+l,o[l]=function(e){t(e),o.document.body.removeChild(a)};var a=o.document.createElement("script");a.src=e+n,o.document.body.appendChild(a)}}]);var r=angular.module("MyBlog.homeModule",[]);r.config(["$routeProvider",function(o){o.when("/home",{templateUrl:"HomePage/home.html",controller:"HomeController"})}]),r.controller("HomeController",["$scope","$rootScope",function(o,e){e.category="home",o.imgs=["img/1.jpg","img/2.jpg","img/3.jpg","img/4.jpg","img/5.jpg"],o.sentence=["知人者智，自知者明。","胜人者有力，自胜者强。","——老子"],o.url=null;var r=document.getElementById("fr").contentWindow.document.getElementById("audio");o.play=function(o){r.src=o,r.play()},o.pause=function(){r.pause()}}]);var t=angular.module("MyBlog.movieModule",[]);t.config(["$routeProvider",function(o){o.when("/movie",{templateUrl:"Movie/movie.html",controller:"movieController"}).when("/movie/:list/:page?",{templateUrl:"Movie/movie.html",controller:"movieController"})}]),t.controller("movieController",["$scope","$rootScope","$routeParams","JsonpService","appConstant","$route",function(o,e,r,t,n,l){e.category="movie";var a=n.count,c=(r.page>0?parseInt(r.page):1)||1;o.currentPage=c;var i=(c-1)*a;r.list=r.list?r.list:"in_theaters",console.log(n.ListUrl+r.list),t.jsonp(n.ListUrl+r.list,{count:a,start:i,q:e.input},function(r){o.subjects=r.subjects,o.total=r.total,o.title=r.title,o.totalPage=Math.ceil(r.total/a),o.pageConfig={total:o.totalPage,current:c,show:10,click:function(o){l.updateParams({page:o})}},e.input="",o.$apply()})}]);var n=angular.module("doubanApp.DetailModule",[]);n.config(["$routeProvider",function(o){o.when("/movie/detail/:id",{templateUrl:"Movie/detail.html",controller:"DetailController"})}]),n.controller("DetailController",["$scope","$routeParams","JsonpService","$rootScope","appConstant",function(o,e,r,t,n){t.category="movie",o.show=!1,r.jsonp(n.detailUrl+e.id,{},function(e){o.show=!0,o.movies=e,e.summary=e.summary.replace(/\n/g,""),e.summary=e.summary.replace(/©豆瓣/g,""),o.summary=e.summary,o.$apply()})}]);var l=angular.module("MyBlog.musicModule",[]);l.config(["$routeProvider",function(o){o.when("/music",{templateUrl:"Music/music.html",controller:"musicController"})}]),l.controller("musicController",["$scope","$rootScope","$routeParams","JsonpService","$interval","appConstant",function(o,e,r,t,n,l){function a(o){$(".item-play span").removeClass("glyphicon-play").addClass("glyphicon-pause"),m.src=o,m.play()}function c(e){e||(e="public_tuijian_spring"),m.currentTime&&(m.currentTime=0),o.id=e,t.jsonp(l.songUrl,{channel:e},function(e){console.log(e.song[0]),o.music=e.song[0],o.url=e.song[0].url,a(e.song[0].url),d=1,i(e.song[0].sid),o.$apply()})}function i(o){$.ajax({url:l.lrcUrl,dataType:"json",data:{sid:o},success:function(o){u(o.lyric)}})}function u(o){$(".lrc").empty();var e,r,t=/\[\d\d\:\d\d(\.|\:)\d\d\]/g,n=/\[\w+\:/g,l=/\]/g,a="<ul>";lrcArr=o.split("\n");for(var c=0;c<lrcArr.length;c++)e=parseInt(lrcArr[c].slice(1,3)),r=parseInt(lrcArr[c].slice(4,6)),isNaN(e)||(lrcArr[c]=lrcArr[c].replace(t,""),lrcArr[c]=lrcArr[c].replace(n,""),lrcArr[c]=lrcArr[c].replace(l,""),a+='<li data-lrcs="'+(60*e+r)+'">'+lrcArr[c]+"</li>");a+="</ul>",$(".lrc").append(a)}function s(o){$(".lrc ul li").each(function(e,r){var t=$(this),n=Math.floor(m.duration);Math.floor(o)==$(this).attr("data-lrcs")&&($(this).text()&&($(".lrc ul li").removeClass("check"),$(this).addClass("check")),$(this).index()>=3&&n-Math.floor(o)>15&&$(".lrc ul").animate({marginTop:-$(".lrc ul li").height()*(t.index()-3)}))})}function p(o,e){var r=Math.floor(e/60);r=r<10?"0"+r:r;var t=Math.floor(e%60);t=t<10?"0"+t:t,o.text(r+":"+t)}e.category="music",o.name="漫步春天";var m=document.getElementById("fr").contentWindow.document.getElementById("audio"),d=0;m.currentTime=0,c(),o.change=function(){$(".music-content").animate({marginLeft:"-1000px"},"slow",function(){t.jsonp(l.channelUrl,{},function(e){o.channels=e.channels,o.$apply()})})},o.back=function(){$(".music-content").animate({marginLeft:"0px"},"slow")},o.select=function(e){var r=e.channel_id;o.name=e.name,$("#"+r).css({background:"rgba(0,0,0,0.5)"}).siblings().css({background:"rgba(0,0,0,0.15)"}).find("span").removeClass("check"),$("#"+r+">span").addClass("check"),c(r)},o.play=function(o){0==d?($(".item-play span").removeClass("glyphicon-play").addClass("glyphicon-pause"),$("#picture").css({background:"rgba(0,0,0,0)"}).text(""),m.play(),d=1):1==d&&($(".item-play span").removeClass("glyphicon-pause").addClass("glyphicon-play"),$("#picture").css({background:"rgba(0,0,0,0.4)"}).text("点击播放"),m.pause(),d=0)},o.next=function(o){c(o)},n(function(){var e=m.currentTime*$(".song-progress").width()/m.duration;$(".progress-time").width(e),p($(".play-time"),m.currentTime),p($(".total-time"),m.duration),m.currentTime==m.duration&&c(o.id),s(m.currentTime)},1e3),o.noVoice=function(){console.log(m.muted),m.muted?($(".voice").removeClass("glyphicon-volume-off").addClass("glyphicon-volume-down"),m.muted=!1):($(".voice").removeClass("glyphicon-volume-down").addClass("glyphicon-volume-off"),m.muted=!0)},o.voice=function(o){m.muted=!1,$(".voice").removeClass("glyphicon-volume-off").addClass("glyphicon-volume-down"),o=o||window.event;var e=o.clientX-$("#voi")[0].offsetLeft-$(".content")[0].offsetLeft-$(".music")[0].offsetLeft-$(".play")[0].offsetLeft,r=e/$("#voi").width();m.volume=r,$(".progress-times").width(e),0==e&&($(".voice").removeClass("glyphicon-volume-down").addClass("glyphicon-volume-off"),m.muted=!0)}}]);var a=angular.module("MyBlog.learnModule",[]);a.config(["$routeProvider",function(o){o.when("/learn",{templateUrl:"project/index.html",controller:"learnController"})}]),a.controller("learnController",["$scope","$rootScope",function(o,e){e.category="learn"}]);var c=angular.module("MyBlog.logModule",[]);c.config(["$routeProvider",function(o){o.when("/log",{templateUrl:"Log/log.html",controller:"logController"})}]),c.controller("logController",["$scope","$rootScope","$routeParams",function(o,e,r){e.category="log"}]);var i=angular.module("MyBlog.personModule",[]);i.config(["$routeProvider",function(o){o.when("/person",{templateUrl:"Personal/person.html",controller:"personController"})}]),i.controller("personController",["$scope","$rootScope","$routeParams",function(o,e,r){e.category="person"}]);var u=angular.module("MyBlog.boardModule",[]);u.config(["$routeProvider",function(o){o.when("/board",{templateUrl:"MessageBoard/board.html",controller:"boardController"})}]),u.controller("boardController",["$scope","$rootScope","$routeParams",function(o,e,r){e.category="board"}])}();